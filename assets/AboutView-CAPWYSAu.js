import{g as J,r as Q,a as Y,o as Z,b as $,c as I,d as V,e as F,f as i,h as L,t as k,w as O,v as U,R as j,n as W,i as tt,F as E,j as nt,k as q}from"./index-_78USCcH.js";var G={exports:{}};(function(x){(function(g){var f=typeof window=="object"&&!!window.document,P=f?window:Object,d=P.Recorder,M=d.i18n;g(P,d,M,M.$T,f),x.exports&&(x.exports=P.RecordApp)})(function(g,f,P,d,M){var n={LM:"2024-04-09 19:22",Current:0,Platforms:{}},t=n.Platforms,e="RecordApp",c="RequestPermission",o="RegisterPlatform",w=g[e];if(w&&w.LM==n.LM){w.CLog(d("uXtA::重复导入{1}",0,e),3);return}g[e]=n,f[e]=n,n.__SID_=0;var D=n.__SID=function(){return++n.__SID_},b=n.__Sync=function(r,l,a){return n.__SID_!=r?(l&&m(d("kIBu::注意：因为并发调用了其他录音相关方法，当前 {1} 的调用结果已被丢弃且不会有回调",0,l)+(a?", error: "+a:""),3),!1):!0},m=function(){var r=arguments;r[0]="["+(m.Tag||e)+"]["+(n.Current&&n.Current.Key||"?")+"]"+r[0],f.CLog.apply(null,r)};n.CLog=m,n[o]=function(r,l){l.Key=r,t[r]&&m(d("ha2K::重复注册{1}",0,r),3),t[r]=l},n.__StopOnlyClearMsg=function(){return d("wpTL::仅清理资源")};var H="Default-H5",B=c+"_H5OpenSet";(function(){var r={Support:function(a){a(!0)},CanProcess:function(){return!0}};n[o](H,r),r[c]=function(a,p,v){var u=n.__Rec;u&&(u.close(),n.__Rec=null),l();var s=n[B];n[B]=null;var S=f(s||{});S.open(function(){p()},v)};var l=function(){if(f.IsOpen()){m("kill open...");var a=f();a.open(),a.close()}};r.Start=function(a,p,v,u){var s=n.__Rec;s!=null&&s.stop(),n.__Rec=s=f(p),s.appSet=p,s.dataType="arraybuffer",s.open(function(){b(a)&&s.start(),v()},u)},r.Stop=function(a,p,v){var u=n.__Rec,s=p?"":n.__StopOnlyClearMsg();if(!u){l(),v(d("bpvP::未开始录音")+(s?" ("+s+")":""));return}var S=function(){if(b(a)){u.close();for(var R in u.set)u.appSet[R]=u.set[R]}},y=function(R){S(),v(R)};if(!p){y(s);return}u.stop(function(R,C,h){S(),p(R,C,h)},y)}})(),n.GetCurrentRecOrNull=function(){return n.__Rec||null},n.Pause=function(){var r=n.Current,l="Pause";if(!(r&&r[l]&&r[l]()!==!1)){var a=n.__Rec;a&&T(l)&&a.pause()}},n.Resume=function(){var r=n.Current,l="Resume";if(!(r&&r[l]&&r[l]()!==!1)){var a=n.__Rec;a&&T(l)&&a.resume()}};var T=function(r){var l=n.Current;if(l&&l.CanProcess())return 1;m(d("fLJD::当前环境不支持实时回调，无法进行{1}",0,r),3)};n.Install=function(r,l){var a=n.Current;if(a){r&&r();return}var p=n.__reqs||(n.__reqs=[]);p.push({s:r,f:l}),r=function(){v("s",arguments)},l=function(){v("f",arguments)};var v=function(C,h){var A=[].concat(p);p.length=0;for(var K=0;K<A.length;K++){var X=A[K][C];X&&X.apply(null,h)}};if(!(p.length>1)){var u=[H],s;for(var S in t)S!=H&&u.push(S);u.reverse();var y=function(C){s=u[C],a=t[s],a.Support(function(h){if(!h)return y(C+1);a.Install?a.Install(R,l):R()})},R=function(){n.Current=a,m("Install platform: "+s),r()};y(0)}},n[c]=function(r,l){var a=D(),p=e+"."+c,v=function(u,s){s=!!s;var S=u+", isUserNotAllow:"+s;b(a,p,S)&&(m(d("YnzX::录音权限请求失败：")+S,1),l&&l(u,s))};m(c+"..."),n.Install(function(){if(b(a,p)){var u=N();if(u){v(u);return}n.Current[c](a,function(){b(a,p)&&(m(c+" Success"),r&&r())},v)}},v)};var z=function(){return d("nwKR::需先调用{1}",0,c)},N=function(){var r="";return n.Current.Key==H&&!M&&(r=d("citA::当前不是浏览器环境，需引入针对此平台的支持文件（{1}），或调用{2}自行实现接入",0,"src/app-support/app-xxx-support.js",e+"."+o)),r};n.Start=function(r,l,a){var p=D(),v=e+".Start",u=function(A){b(p,v,A)&&(m(d("ecp9::开始录音失败：")+A,1),a&&a(A))};m("Start...");var s=n.Current;if(!s){u(z());return}r||(r={});var S={type:"mp3",sampleRate:16e3,bitRate:16,onProcess:function(){}};for(var y in S)r[y]||(r[y]=S[y]);for(var y in t){var R=t[y];R.AllStart_Clean&&R.AllStart_Clean(r)}var C=!1;if(s.Start_Check&&(C=s.Start_Check(r)),C===!1){var h=f(r);C=h.envCheck({envName:s.Key,canProcess:s.CanProcess()}),C||(C=N())}if(C){u(d("EKmS::不能录音：")+C);return}n._SRec=0,s.Start(p,r,function(){b(p,v)&&(m(d("k7Qo::已开始录音"),r),n._STime=Date.now(),l&&l())},u)},n.Stop=function(r,l){var a=D(),p=e+".Stop",v=function(y){if(b(a,p,y)){m(d("Douz::结束录音失败：")+y,r?1:0);try{l&&l(y)}finally{u()}}},u=function(){n._SRec=n.__Rec,n.__Rec=null};m("Stop... "+d("wqSH::和Start时差：{1}ms",0,n._STime?Date.now()-n._STime:-1)+" Recorder.LM:"+f.LM+" "+e+".LM:"+n.LM);var s=Date.now(),S=n.Current;if(!S){v(z());return}S.Stop(a,r?function(y,R,C){if(b(a,p)){m(d("g3VX::结束录音 耗时{1}ms 音频时长{2}ms 文件大小{3}b {4}",0,Date.now()-s,R,y.byteLength,C));try{r(y,R,C)}finally{u()}}}:null,v)}})})(G);var et=G.exports;const _=J(et),rt={class:"main"},ot={class:"mainBox"},it={class:"pd"},at={style:{margin:"0 20px"}},lt={class:"btns"},st={style:{display:"inline-block","margin-right":"36px"}},ut={style:{display:"inline-block"}},pt={class:"mainBox"},ct={style:{height:"40px",width:"300px",display:"inline-block",background:"#999",position:"relative","vertical-align":"bottom"}},ft={class:"ctrlProcessT",style:{"padding-left":"50px","line-height":"40px",position:"relative"}},dt={style:{"padding-top":"10px"}},vt={class:"mainBox"},yt={class:"mainLog"},Ct=["innerHTML"],gt=["onClick"],mt=["onClick"],St=["innerHTML"],Rt={key:0},wt={style:{color:"red"}},bt=["onClick"],kt=["onUpdate:modelValue"],Lt={__name:"AboutView",setup(x){const g=Q({type:"mp3",bitRate:16,sampleRate:16e3,duration:0,durationTxt:"0",powerLevel:0,logs:[],recLogLast:null,wave:null});Y(null),Z(()=>{_.Install(()=>f("Install成功，环境："+_.Current.Key,2),t=>f("RecordApp.Install出错："+t,1))});const f=(t,e,c=null)=>{const o={idx:g.logs.length,msg:t,color:e,res:c,playMsg:"",down:0,down64Val:""};c!=null&&c.blob&&(g.recLogLast=o),g.logs.unshift(o)},P=()=>{f("开始请求授权..."),_.RequestPermission(()=>f(_.Current.Key+"已授权",2),(t,e)=>{f((_.Current&&_.Current.Key||"[?]")+(e?" UserNotAllow, ":"")+" 授权失败："+t,1)})},d=()=>{if(!_.Current){f("未请求权限",1);return}f("录制中..."),_.Start({type:g.type,bitRate:+g.bitRate,sampleRate:+g.sampleRate,onProcess:(t,e,c)=>{g.duration=c,g.durationTxt=n(c),g.powerLevel=e,g.wave.input(t[t.length-1],e)}},()=>{g.wave=j.WaveView({elem:".ctrlProcessWave"})},t=>f("录音失败："+t,1))},M=()=>{_.Stop((t,e,c)=>{f("录音完成！",2,{blob:new Blob([t],{type:c}),duration:e})},t=>f("停止失败："+t,1))},n=(t,e)=>{const c=t%1e3;t=(t-c)/1e3;const o=t%60;t=(t-o)/60;const w=t%60,D=(t-w)/60;return`${D?D+":":""}${w?w+":":""}${o}.${String(c).padStart(3,"0")}`};return(t,e)=>{const c=$("AUDIO");return I(),V("div",rt,[F(t.$slots,"top"),i("div",ot,[i("div",it,[L(" 类型："+k(t.type)+" ",1),i("span",at,[e[9]||(e[9]=L(" 比特率: ")),O(i("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>t.bitRate=o),style:{width:"60px"}},null,512),[[U,t.bitRate]]),e[10]||(e[10]=L(" kbps "))]),e[11]||(e[11]=L(" 采样率: ")),O(i("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>t.sampleRate=o),style:{width:"60px"}},null,512),[[U,t.sampleRate]]),e[12]||(e[12]=L(" hz "))]),i("div",{class:"btns"},[i("button",{onClick:P},"请求权限"),i("button",{onClick:d},"录制"),i("button",{onClick:M},"停止")]),i("div",lt,[i("span",st,[i("button",{onClick:e[2]||(e[2]=(...o)=>t.recPause&&t.recPause(...o))},"暂停"),i("button",{onClick:e[3]||(e[3]=(...o)=>t.recResume&&t.recResume(...o))},"继续"),i("button",{onClick:e[4]||(e[4]=(...o)=>t.recStopX&&t.recStopX(...o))},"停止(仅清理)")]),i("span",ut,[i("button",{onClick:e[5]||(e[5]=(...o)=>t.recPlayLast&&t.recPlayLast(...o))},"播放"),i("button",{onClick:e[6]||(e[6]=(...o)=>t.recUploadLast&&t.recUploadLast(...o))},"上传"),i("button",{onClick:e[7]||(e[7]=(...o)=>t.recDownLast&&t.recDownLast(...o))},"本地下载")])])]),i("div",pt,[e[15]||(e[15]=i("div",{style:{height:"100px",width:"300px",border:"1px solid #ccc","box-sizing":"border-box",display:"inline-block","vertical-align":"bottom"},class:"ctrlProcessWave"},null,-1)),i("div",ct,[i("div",{class:"ctrlProcessX",style:W([{height:"40px",background:"#0b1",position:"absolute"},{width:t.powerLevel+"%"}])},null,4),i("div",ft,k(t.durationTxt+"/"+t.powerLevel),1)]),i("div",dt,[i("div",null,[e[14]||(e[14]=i("span",{class:"lb"},"AppUseH5 :",-1)),i("label",null,[i("input",{type:"checkbox",onClick:e[8]||(e[8]=(...o)=>t.setAppUseH5&&t.setAppUseH5(...o))}),e[13]||(e[13]=L("App里面总是使用Recorder H5录音"))])])])]),i("div",vt,[tt(c,{ref:"LogAudioPlayer",style:{width:"100%"}},null,512),i("div",yt,[(I(!0),V(E,null,nt(t.logs,o=>(I(),V("div",{key:o.idx},[i("div",{style:W({color:o.color==1?"red":o.color==2?"green":o.color})},[i("span",null,"["+k(t.getTime())+"]",1),i("span",{innerHTML:o.msg},null,8,Ct),o.res?(I(),V(E,{key:0},[L(k(t.intp(o.res.rec.set.bitRate,3))+"kbps "+k(t.intp(o.res.rec.set.sampleRate,5))+"hz 编码 "+k(t.intp(o.res.blob.size,6))+"b ["+k(o.res.rec.set.type)+"] "+k(o.res.durationTxt)+"ms ",1),i("button",{onClick:w=>t.recdown(o.idx)},"下载",8,gt),i("button",{onClick:w=>t.recplay(o.idx)},"播放",8,mt),i("span",{innerHTML:o.playMsg},null,8,St),o.down?(I(),V("span",Rt,[i("span",wt,k(o.down),1),e[16]||(e[16]=L(" 没弹下载？试一下链接或复制文本 ")),i("button",{onClick:w=>t.recdown64(o.idx)}," 生成Base64文本 ",8,bt),o.down64Val?O((I(),V("textarea",{key:0,"onUpdate:modelValue":w=>o.down64Val=w},null,8,kt)),[[U,o.down64Val]]):q("",!0)])):q("",!0)],64)):q("",!0)],4)]))),128))])]),F(t.$slots,"bottom")])}}};export{Lt as default};
